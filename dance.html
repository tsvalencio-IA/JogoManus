<!DOCTYPE html>
<html lang="pt-br">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>AR DANCE - thIAguinho Arcade</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/three.js/r128/three.min.js"></script>
    <style>
        body { margin: 0; overflow: hidden; background: #000; font-family: sans-serif; }
        #video-container { position: fixed; top: 0; left: 0; width: 100%; height: 100%; z-index: -1; }
        #video-feed { width: 100%; height: 100%; object-fit: cover; opacity: 0.5; transform: scaleX(-1); }
        #game-canvas { position: fixed; top: 0; left: 0; width: 100%; height: 100%; }
        #ui { position: fixed; top: 20px; right: 20px; color: #00ff00; font-size: 32px; text-shadow: 0 0 10px #000; }
        .back-btn { position: fixed; bottom: 20px; left: 20px; padding: 10px 20px; background: #ffff00; color: black; text-decoration: none; border-radius: 5px; font-weight: bold; }
    </style>
</head>
<body>
    <div id="video-container">
        <video id="video-feed" autoplay playsinline></video>
    </div>
    <canvas id="game-canvas"></canvas>
    <div id="ui">PONTOS: <span id="score">0</span></div>
    <a href="index.html" class="back-btn">VOLTAR</a>

    <script type="module">
        import { Camera } from './js/modules/camera.js';
        import { IA } from './js/modules/ia.js';

        let scene, camera, renderer, avatar;
        let score = 0;
        let lastFrameData = null;

        async function init() {
            await Camera.init('video-feed');
            
            scene = new THREE.Scene();
            camera = new THREE.PerspectiveCamera(75, window.innerWidth / window.innerHeight, 0.1, 1000);
            renderer = new THREE.WebGLRenderer({ canvas: document.getElementById('game-canvas'), alpha: true });
            renderer.setSize(window.innerWidth, window.innerHeight);

            scene.add(new THREE.AmbientLight(0xffffff, 1));
            
            // Avatar de Dança (Esferas conectadas)
            avatar = new THREE.Group();
            const body = new THREE.Mesh(new THREE.SphereGeometry(0.5), new THREE.MeshPhongMaterial({ color: 0x00ff00 }));
            avatar.add(body);
            scene.add(avatar);

            camera.position.z = 5;
            animate();
        }

        function animate() {
            requestAnimationFrame(animate);

            if (Camera.active) {
                const analysis = IA.analyzeMotion(Camera.video, lastFrameData);
                lastFrameData = analysis.frameData;

                // Avatar reage à posição do movimento
                avatar.position.x = analysis.directionX * 2;
                avatar.position.y = -analysis.directionY * 2;
                
                // Pontuação baseada na fluidez (intensidade contínua)
                if (analysis.intensity > 5) {
                    score += Math.floor(analysis.intensity / 10);
                }
            }

            // Efeito visual de pulsação
            avatar.scale.setScalar(1 + Math.sin(Date.now() * 0.01) * 0.1);

            document.getElementById('score').innerText = score;
            renderer.render(scene, camera);
        }

        window.addEventListener('resize', () => {
            camera.aspect = window.innerWidth / window.innerHeight;
            camera.updateProjectionMatrix();
            renderer.setSize(window.innerWidth, window.innerHeight);
        });

        init();
    </script>
</body>
</html>
